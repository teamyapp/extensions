<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Development</title>
    <link rel="stylesheet" href="index.css"/>
</head>
<body>
<div id="content">
    <table>
        <tbody>
        <tr>
            <td>Access Token:</td>
            <td>
                <textarea id="accessTokenInput" type="text" value=""></textarea>
            </td>
        </tr>
        <tr>
            <td>Team ID:</td>
            <td>
                <input id="teamIdInput" type="text" value="0"/>
            </td>
        </tr>
        <tr>
            <td>Required action index:</td>
            <td><input id="requiredActionIndexInput" type="text" value="0"/>
            </td>
        </tr>
        <tr>
            <td>Action:</td>
            <td>
                <button onclick="loadExtension()">Load extension</button>
            </td>
        </tr>
        </tbody>
    </table>
    <div id="preview">
        <h1>Preview</h1>
        <div class="view-section">
            <h2>Required action:</h2>
            <div id="required-action-view"></div>
        </div>
        <div class="view-section">
            <h2>Settings:</h2>
            <div id="settings-view"></div>
        </div>

    </div>
</div>
</body>
<script type="application/javascript">
    const accessTokenInput = document.querySelector('#accessTokenInput');
    const teamIdInput = document.querySelector('#teamIdInput');
    const indexInput = document.querySelector('#requiredActionIndexInput');
    const requiredActionView = document.querySelector('#required-action-view');
    const settingsView = document.querySelector('#settings-view');

    accessTokenInput.value = localStorage.getItem('accessToken') || '';
    accessTokenInput.addEventListener('change', () => {
        localStorage.setItem('accessToken', accessTokenInput.value);
    });

    teamIdInput.value = localStorage.getItem('teamId') || '0';
    teamIdInput.addEventListener('change', () => {
        localStorage.setItem('teamId', teamIdInput.value);
    });

    indexInput.value = localStorage.getItem('actionIndex') || '0';
    indexInput.addEventListener('change', () => {
        localStorage.setItem('actionIndex', indexInput.value);
    });

    async function loadExtension() {
        const {App} = await import('/app/app.js');
        const app = new App();
        app.init({
            getAssetUrl(relativePath) {
                return `app/${relativePath}`
            },
            getAccessToken() {
                return accessTokenInput.value;
            }
        });

        const teamId = parseInt(teamIdInput.value)
        const requiredActions = await app.requiredActions(teamId);
        if (requiredActions.length > 0) {
            const index = parseInt(indexInput.value);
            requiredActions[index].renderView({
                container: requiredActionView
            });
        }

        app.renderSettingsView?.call(null, teamId, settingsView);
    }
</script>
</html>